import "https://deno.land/std@0.224.0/dotenv/load.ts";
import { searchGithubRepositories } from "./repository.ts";
import { fetchCves } from "./nvd.ts";

// わかりやすいのでとりあえずLog4Shellあたりの日付でテストしてる
const cves = await fetchCves(
  "2021-12-10T00:00:00.0000Z",
  "2021-12-11T00:00:00.0000Z",
);

for (const defCveItem of cves.vulnerabilities) {
  const cve = defCveItem.cve.id;
  if (cve) {
    console.log(`CVE found: ${cve}`);
    try {
      const repositories = await searchGithubRepositories(cve);
      console.log(repositories);
    } catch (error) {
      console.error(`Error fetching repositories for CVE ${cve}:`, error);
    }
  } else {
    console.log("No CVE identifier found for this advisory.");
  }
}

Deno.exit();
