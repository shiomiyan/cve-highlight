import { SearchResultItemConnection } from "npm:@octokit/graphql-schema";
import { graphql } from "./graphql.ts";

export const githubRepositoriesQuery = `
  query githubRepositories($searchQuery: String!, $first: Int!) {
    search(type: REPOSITORY, query: $searchQuery, first: $first) {
      repositoryCount
      nodes {
        ... on Repository {
          name
          url
          stargazerCount
        }
      }
    }
  }
`;

export interface githubRepositories {
  search: SearchResultItemConnection;
}

export async function searchGithubRepositories(
  word: string,
  first: number = 10,
) {
  const repositories = await graphql<githubRepositories>(
    githubRepositoriesQuery,
    { searchQuery: `is:public sort:stars-desc in:name ${word}`, first },
  );
  return repositories;
}
