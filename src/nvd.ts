import { JSONSchemaForNVDVulnerabilityDataAPIVersion221 } from "./nvd-types.d.ts";

const NVD_API_BASE_URL = "https://services.nvd.nist.gov/rest/json/cves/2.0/";

/**
 * Search for CVEs published between `pubStartDate` and `pubEndDate`.
 * CVEs that have been rejected are excluded using `noRejected` parameter.
 * date/time is ISO8601 format.
 * @see {@link https://nvd.nist.gov/developers/vulnerabilities|NVD's CVE API Document}
 */
export async function fetchCves(
  pubStartDate: string,
  pubEndDate: string,
): Promise<JSONSchemaForNVDVulnerabilityDataAPIVersion221> {
  const url = new URL(NVD_API_BASE_URL);
  const params = new URLSearchParams({
    pubStartDate,
    pubEndDate,
    noRejected: "",
  });
  url.search = params.toString();

  const resp = await fetch(url);
  const data: JSONSchemaForNVDVulnerabilityDataAPIVersion221 = await resp
    .json();

  return data;
}
