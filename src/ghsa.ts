import { SecurityAdvisoryConnection } from "npm:@octokit/graphql-schema";
import { graphql } from "./graphql.ts";

export interface Ghsa {
  securityAdvisories: SecurityAdvisoryConnection;
}

export const securityAdvisoriesQuery = `
query securityAdvisories($publishedSince: DateTime!) {
  securityAdvisories(first: 20, publishedSince: $publishedSince) {
    edges {
      node {
      	ghsaId
        summary
        severity
        cvss {
          vectorString
        }
        identifiers {
          type
          value
        }
      }
    }
  }
}
`;

export async function getSecurityAdvisories(publishedSince: string) {
  const advisories = await graphql<Ghsa>(securityAdvisoriesQuery, {
    publishedSince,
  });
  return advisories;
}
